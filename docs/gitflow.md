## Git flow

Данный git glow является сильно упрощённой версией известной статьи [A successful git branching model.](https://nvie.com/posts/a-successful-git-branching-model/)

Ветка origin/master является главной. То есть, исходный код в ней должен находиться в состоянии production-ready в любой произвольный момент времени. В начале разработки от неё отделяется первая основна ветка `rc-0.1.0`, в которой начинается основная работа над продуктом. Процесс разработки идёт следующим образом: если разработчик хочет добавить фичу или пофиксить баг, он ответвляется от этой ветки, создавая так называемую тематическую ветку (topic branches). Затем, когда фича готова, пушит эту ветку на сервер и запрашивает merge request. Этот merge request проходит код ревью и, если всё хорошо, то сливается с `rc-0.1.0`, либо отправляется на доработку. В будущем, когда rc веток будет несколько, то merge request стоит производить во все нижестоящие ветки. После того как ветка `rc-0.1.0` проходит стадию `feature freeze`, от неё создаётся следующая основная ветка `rc-0.2.0`, а `rc-0.1.0` уходить на стадию стабилизации. `feature freeze` означает, что в эту ветку больше нельзя планировать новых фич, но добавлять ранее запланированные фичи в неё всё ещё можно. После релиза основной ветки и рассылки собранного из этой ветки приложения клиентам, эта ветка закрывается. Это означает, что с этого момента из неё запрещено ответвлять тематические ветки и вливать в неё другие ветки. Если в ветке, которая прошла стадию релиза и теперь закрыта, были обнаружены ошибки, которые надо исправить, то из неё создаётся специальная хот-фикс ветка, например `rc-0.1.1`. Если после релиза и закрытия хот-фикс ветки, были найдены ещё ошибки, требующие правки, то создаётся следующая хотфикс ветка `rc-0.1.2`. После того, как самая старшая ветка становиться такой-же стабильной, как и master, она вливается в master, и на коммите слияния проставляется соответствующий тег, например `0.1.2` или `0.7.0`. После того, как продукт считается готовым, поднимается основная цифра версии, а следующая за ней сбрасывается. Например `rc-0.7.0` -\> `rc-1.0.0`. Далее идут версии `rc-1.1.0`, `rc-1.2.0`, `rc-1.3.0` и т.д.

## Правила именования веток.

Самая стабильная версия находиться в origin/master. Ветки, которые идут до основного релиза продукта, называются `rc-0.x.x`, которые после - `rc-1.x.x`. Например `rc-0.8.0`, `rc-0.10.0`, `rc-1.5.0`. Это основные ветки или ветки релиза. Когда разработчик хочет добавить фичу или пофиксить баг, он должен ответвиться от этой ветки и дать имя новой ветке согласно следующему шаблону: `< Имя ветки без rc >/< инициалы.фамилия разработчика >/( feature,bugfix,refactoring,doc )/< краткое описание фичи или ошибки >`. Всё должно быть написано в нижнем регистре с подчёркиванием вместо пробела.
Примеры:

`1.5.0/a.v.kuznecov/feature/added_reboot_command`
`0.7.1/a.v.kuznecov/bugfix/status_protocol_fix`
`1.5.0/v.a.baranov/feature/intelligent_mode`
`1.6.0/v.a.baranov/doc/operating_instructions`

После слияния основной ветки с origin/master, на коммите слияния проставляется аннотированный тег с именем ветки без `rc`, например `rc-1.7.0` -\> `1.7.0`. Комментарии к тегам этим пишутся в свободной форме.

## Коментарии к коммитам.

В комментарии к коммиту в первой строке должна быть ссылка на задачу. Далее через пустую строку может следовать список с описанием того, что было сделано в рамках этого коммита. Каждый элемент списка должен начинается с `"-"`, затем идёт пробел, затем - описание с заглавной буквы. В конце описания должна стоять точка. Так следует оформляться даже в том случае, если в списке всего один комментарий.
Примеры:

```
http://109.195.102.60:8086/agiles/94-72/current?issue=knowledge_base-1

- Выла добавлена кнопка самоликвидации БС. 
```

\~

```
http://109.195.102.60:8086/agiles/94-72/current?issue=knowledge_base-666

- Тип uuid модема был изменён с int на float. 
- Была убрана обратная совместимость Mocha API. 
```

## Правила merge request.

После того как разработчик считает, что задача была выполнена, он пушит тематическую ветку на сервер и запрашивает слияние с основной веткой. Во время merge request в GitLab, в заголовке и в описании merge request пишется ссылка на задачу, ставится галка, что тематическая ветка после слияния mr с основной веткой удаляется. Также обязательно выбираются люди, которые должны провести code review, и ответственный за mr (обычно это ответственный за проект). После того, как разработчик получил все апрувы от ревьюеров, ответственный за mr сливает тематическую ветку в основную с обязательным удалением тематической ветки и созданием коммита слияния.

## Состояния rc веток и версии приложения.

Все `rc` ветки могут находиться в трёх состояниях:

1. До feature freeze, когда туда активно добрасываются новые фичи.
2. Между feature freeze и release, когда ветка стабилизируется. На этом этапе в ветку запрещено планировать новые фичи, а вся основная работа сосредоточена на то чтобы найти и исправить все ошибки, и выпустить релиз этой ветки.
3. Ветка после релиза. В этом состоянии ветка не активна, а что-то добрасывать в неё строго запрещено.

Во время смены состояния ветки, на соответствующем коммите ставиться аннотированный тег. Этот тег имеет вид `x.x.x-feature_freeze` или `x.x.x-release`. Например, `0.5.0-feature_freeze` или `1.6.1-release`. Комментарии к тегу пишутся в свободной форме. По этим тегам определяется текущее состояние ветки и полная версия приложения. Любые собранные из этого репозитория приложения имеют версию следующего вида `x.x.x-<develop, alpha, beta, release>`. Например, `1.5.0-alpha` или `1.4.5-release`. При отображении версии приложения пользователю, слово '-release' можно опустить. Например, `1.4.5`. Все приложения, собранные до feature freeze имеют суффикс `alpha`, на стадии стабилизации `beta`, а после релиза соответственно `release`. Все приложения, собранные из тематических веток, в названии версии имеют суффикс `develop`. Все приложения, собранные из main\\master ветки по умолчанию считаются прошедшими стадию релиза и имеют суффикс `release` (номер версии берётся из тега слияния).

## Общие правила работы.

* При создании репозитория обязательно создавайте .gitignore. В обычных условиях это делается так: заходите на сайт https://www.toptal.com/developers/gitignore и вбиваете там языки, IDE и системы сборки, которые будут применяться в проекте. Например `C++`, `Python`, `CMake`, `QtCreator`, `CLion`. После этого генерируете .gitignore и добавляете туда свои кейсы, если это необходимо. После чего коммитите .gitignore в ваш проект.
* force push в удалённые репозитории запрещены.
* Не надо делать большие merge request'ы с большим количеством изменений. Если в рамках одной задачи планируются значительные изменения в коде или множество изменений в нескольких участках, то задачу необходимо разбить на несколько. Человек, который проводит code review вашего merge request, должен хорошо и быстро осознать, что вы написали. Написание за раз большого объёма размазанного по многим участком кода не ускорит вам работу, но значительно усложнит её тому, кто проводит CR.
* Имена всех создаваемых git проектов должны именоваться в нижнем регистре без пробелов. В качестве разделителя можно использовать символ нижнего подчёркивания "_" либо "-". Например `adsvel_conrol` или `slp-bs`.
* При взаимодействии с сервером обязательно использовать SSH ключи. Как настроить ключ подробно описано в соответствующей инструкции.
* Если во время merge request возникли конфликты, их решает автор доброски. Т.е. разработчик, который писал код этой доброски.

---

<p style="text-align:center;">v 0.7</p>
<p style="text-align:center;">Кузнецов (riv) Андрей. ADSVEL 2021.</p>
